<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>WVAC Observing Locations</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.14.0/mapbox-gl.js"></script>
<style>
body { margin: 0; padding: 0; }
#map {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    width: 100vw;
    height: 100vh;
    min-height: 400px;
    max-width: 100vw;
}
/* Control button base styles */
.map-control-btn {
    position: relative;
    z-index: 1001;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    padding: 0;
    font-size: 0; /* hide text nodes if present */
    background: #FFC300;
    color: #000;
    border: none;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    cursor: pointer;
}
.map-control-btn svg { width: 22px; height: 22px; display: block; }
/* Allow specific controls to show text (e.g., 3D label) */
.map-control-btn.show-text { font-size: 14px; padding: 0 8px; width: auto; height: 36px; }

/* Controls container that groups the buttons */
.map-controls {
    position: absolute;
    right: 10px;
    bottom: 10px;
    display: flex;
    flex-direction: column-reverse; /* stack bottom-up visually */
    gap: 4px;
    align-items: flex-end;
    z-index: 1000;
}

/* Fullscreen button: show with other controls and scale on mobile */
.fs-control { display: inline-flex; }

/* Specific vertical positions can be overridden by inline style or additional classes */

/* Mobile adjustments: hide light pollution toggle and scale down other controls */
@media (max-width: 600px) {
    .map-control-btn { width: 34px; height: 34px; border-radius: 6px; }
    .map-control-btn svg { width: 14px; height: 14px; }
    .rotate-control, .threeD-control { transform: scale(0.95); }
    .lp-control { display: none !important; }
    .map-controls { right: 6px; bottom: 6px; gap: 4px; }
}
@media (max-width: 600px) {
    #map {
        min-height: 300px;
        height: 100vh;
    }
    .mapboxgl-popup-content {
        font-size: 14px !important;
        padding: 12px 8px !important;
        min-width: 0 !important;
        max-width: 95vw !important;
        max-height: 60vh !important;
        overflow-y: auto !important;
        word-break: break-word !important;
        box-sizing: border-box !important;
        white-space: normal !important;
        display: block !important;
    }
}
</style>
</head>
<body>
<div id="map"></div>
<script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoid3Zhc3Ryb25vbXkiLCJhIjoiY21ldWIzcjgzMDU4cjJycHRzYm1qNzJ6OCJ9.gkbKw4F2VlUJjxPaI-7mqQ';
    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/satellite-streets-v12', // Use the standard style for the map
        projection: 'globe', // display the map as a globe
        zoom: 9.3 , // initial zoom level, 0 is the world view, higher values zoom in
        center: [-120.552317, 47.5392318] // center the map on this longitude and latitude
    });

    map.on('style.load', () => {
        map.addSource('mapbox-dem', {
            'type': 'raster-dem',
            'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
            'tileSize': 512,
            'maxzoom': 14
        });
        // add the DEM source as a terrain layer with exaggerated height
        map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1.1 });
    });

    map.addControl(new mapboxgl.NavigationControl());
    map.scrollZoom.enable();

    map.on('style.load', () => {
        map.setFog({}); // Set the default atmosphere style
    });

    // Create controls container and add to body (if not already present)
    let controlsContainer = document.querySelector('.map-controls');
    if (!controlsContainer) {
        controlsContainer = document.createElement('div');
        controlsContainer.className = 'map-controls';
        document.body.appendChild(controlsContainer);
    }

    // Add 3D toggle button (icon)
    const threeDButton = document.createElement('button');
    threeDButton.className = 'map-control-btn threeD-control show-text';
    threeDButton.setAttribute('aria-label', 'Toggle 3D view');
    threeDButton.textContent = '3D';
    controlsContainer.appendChild(threeDButton);

    let is3D = false;
    threeDButton.addEventListener('click', () => {
        if (!is3D) {
            map.setPitch(60); // tilt the map for 3D effect
            map.setBearing(30); // rotate for better 3D view
            is3D = true;
        } else {
            map.setPitch(0); // reset to 2D
            map.setBearing(0);
            is3D = false;
        }
    });

    // Add rotate button (icon)
    const rotateButton = document.createElement('button');
    rotateButton.className = 'map-control-btn rotate-control';
    rotateButton.setAttribute('aria-label', 'Rotate map');
    rotateButton.innerHTML = `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M21 12a9 9 0 1 1-3-6.7"/>
            <polyline points="21 3 21 9 15 9" />
        </svg>`;
    controlsContainer.appendChild(rotateButton);

    let currentBearing = 0;
    let rotateInterval;
    rotateButton.addEventListener('mousedown', () => {
        rotateInterval = setInterval(() => {
            currentBearing = (currentBearing + 11.25) % 360;
            map.setBearing(currentBearing);
        }, 50); // rotate every 50ms for fluid motion
    });
    rotateButton.addEventListener('mouseup', () => {
        clearInterval(rotateInterval);
    });
    rotateButton.addEventListener('mouseleave', () => {
        clearInterval(rotateInterval);
    });
    rotateButton.addEventListener('touchstart', () => {
        rotateInterval = setInterval(() => {
            currentBearing = (currentBearing + 11.25) % 360;
            map.setBearing(currentBearing);
        }, 50);
    });
    rotateButton.addEventListener('touchend', () => {
        clearInterval(rotateInterval);
    });

    // Add Light Pollution Map Layer (VIIRS 2021)
    function addLightPollutionLayer() {
        try {
            if (!map.getSource('lightpollution')) {
                map.addSource('lightpollution', {
                    'type': 'raster',
                    'tiles': [
                        'https://tiles.lightpollutionmap.info/night/2021/{z}/{x}/{y}.png'
                    ],
                    'tileSize': 256,
                    'attribution': 'Â© lightpollutionmap.info'
                });
            }
            if (!map.getLayer('lightpollution-layer')) {
                map.addLayer({
                    'id': 'lightpollution-layer',
                    'type': 'raster',
                    'source': 'lightpollution',
                    'minzoom': 0,
                    'maxzoom': 18,
                    'paint': {
                        'raster-opacity': 0.6
                    },
                    'layout': {
                        'visibility': 'visible'
                    }
                }, undefined); // Add as top layer
            }
        } catch (e) {
            console.error('Failed to add light pollution layer:', e);
        }
    }
    map.on('style.load', addLightPollutionLayer);

    // Add Light Pollution Toggle Button
    const lpButton = document.createElement('button');
    lpButton.className = 'map-control-btn lp-control';
    lpButton.setAttribute('aria-label', 'Toggle light pollution');
    lpButton.innerHTML = `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M12 2C7 2 2.7 5.1 1 9.5 2.7 13.9 7 17 12 17s9.3-3.1 11-7.5C21.3 5.1 17 2 12 2z"/>
            <circle cx="12" cy="11" r="3" />
        </svg>`;
    // append controls in order so they stack tightly (bottom to top in DOM)
    // desired visual order (bottom-most first): lpButton, fsButton, rotateButton, threeDButton
    // lpButton already created above
    // create Fullscreen button
    const fsButton = document.createElement('button');
    fsButton.className = 'map-control-btn fs-control';
    fsButton.setAttribute('aria-label', 'Toggle fullscreen');
    fsButton.innerHTML = `
        <svg class="fs-enter" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M3 9V3h6"/>
            <path d="M21 15v6h-6"/>
            <path d="M21 3l-7 7"/>
            <path d="M3 21l7-7"/>
        </svg>
        <svg class="fs-exit" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="display:none;">
            <path d="M8 3H3v5"/>
            <path d="M16 21h5v-5"/>
            <path d="M3 3l18 18"/>
        </svg>`;
    // append in order
    controlsContainer.appendChild(lpButton);
    controlsContainer.appendChild(fsButton);
    controlsContainer.appendChild(rotateButton);
    controlsContainer.appendChild(threeDButton);

    // Fullscreen toggle for #map using Fullscreen API
    function isFullscreen() {
        return document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement;
    }
    function requestFullscreen(el) {
        if (el.requestFullscreen) return el.requestFullscreen();
        if (el.webkitRequestFullscreen) return el.webkitRequestFullscreen();
        if (el.msRequestFullscreen) return el.msRequestFullscreen();
    }
    function exitFullscreen() {
        if (document.exitFullscreen) return document.exitFullscreen();
        if (document.webkitExitFullscreen) return document.webkitExitFullscreen();
        if (document.msExitFullscreen) return document.msExitFullscreen();
    }

    fsButton.addEventListener('click', async () => {
        const mapEl = document.getElementById('map');
        if (!isFullscreen()) {
            try {
                await requestFullscreen(mapEl);
            } catch (e) {
                console.warn('Fullscreen request failed', e);
            }
        } else {
            try {
                await exitFullscreen();
            } catch (e) {
                console.warn('Exit fullscreen failed', e);
            }
        }
    });

    // Update fullscreen icon on change
    function updateFsIcon() {
        const enterIcon = fsButton.querySelector('.fs-enter');
        const exitIcon = fsButton.querySelector('.fs-exit');
        if (isFullscreen()) {
            if (enterIcon) enterIcon.style.display = 'none';
            if (exitIcon) exitIcon.style.display = 'block';
        } else {
            if (enterIcon) enterIcon.style.display = 'block';
            if (exitIcon) exitIcon.style.display = 'none';
        }
    }
    document.addEventListener('fullscreenchange', updateFsIcon);
    document.addEventListener('webkitfullscreenchange', updateFsIcon);
    document.addEventListener('msfullscreenchange', updateFsIcon);

    let lpVisible = true;
    lpButton.addEventListener('click', () => {
        if (map.getLayer('lightpollution-layer')) {
            lpVisible = !lpVisible;
            map.setLayoutProperty('lightpollution-layer', 'visibility', lpVisible ? 'visible' : 'none');
        }
    });

    // Lake Wenatchee Popup
    const lkwenapopup = new mapboxgl.Popup({ offset: 25, scale: 3 }).setHTML(`
    <div class="popup-title">Lake Wenatchee State Park</div>
    <div class="popup-subtitle">553 Ware Rd, Leavenworth, WA 98826</div>
    <div class="popup-narrative">
        <strong class="golden">Contact:</strong> (509)763-3101<br><br>
        <strong class="golden">Website:</strong> <a href="https://parks.wa.gov/find-parks/state-parks/lake-wenatchee-state-park" target="_blank" style="color: #1E90FF;">https://parks.state.wa.us/</a><br><br>
        <strong class="golden">Rules:</strong> Call to gain permission prior after hours entrance. Other rules apply. <br><br>
        <strong class="golden">Bortle:</strong> 3 (Rural) <br><br>
        <strong class="golden">SQM:</strong> 21.5 <br><br>
        <strong class="golden">Viewshed:</strong><br>
        View is mostly zenith and western horizon. Seeing is restricted due to tree canopy and ridge lines. <br><br>
        <strong class="golden">Comments:</strong><br>
        Gates close at dusk and special permissions is not always granted. Its always worth getting a campsite here at washington.goingtocamp.com
    </div>
    <div style='margin-top:1em; text-align:center;'>
      <a href="https://drive.google.com/file/d/1IaDMJNFV3wiba0XA58yup0l_4N9XvoKa/view?usp=sharing" target="_blank" style="font-size:18px; color:#1E90FF; text-decoration:underline;">View Lake Wenatchee Image</a>
    </div>
    `);
    // Make Lake Wenatchee popup text larger
    const popupStyle = document.createElement('style');
    popupStyle.innerHTML = `
        @import url('https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap');
        .mapboxgl-popup-content {
                font-family: 'Roboto', Arial, sans-serif;
                font-size: 20px;
                width: auto;
                min-width: 0;
                max-width: 1500px;
                max-height: 40vh;
                overflow-y: auto;
                padding: 16px 12px;
                box-sizing: border-box;
                background: #000;
                color: #fff;
                word-break: break-word;
                white-space: normal;
                display: block;
                border-radius: 18px;
                box-shadow: 0 4px 24px rgba(0,0,0,0.35);
                border: 6px solid #71797E;
        }
        .popup-narrative strong.golden {
            color: #FFC300;
                white-space: normal;
                word-break: break-word;
                line-height: 1.3;
        }
        .popup-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 0.3em;
            line-height: 1;
            color: #fff;
            text-align: center;
        }
        .popup-subtitle {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 0.7em;
            line-height: 1;
            color: #ccc;
            text-align: center;
        }
        .popup-narrative {
            font-size: 16px;
            color: #fff;
        }
    `;
    document.head.appendChild(popupStyle);
    // Lake Wenatchee Marker
    const lkwena = new mapboxgl.Marker({ color: '#fc0303', rotation: 0, scale: .5 })
        .setLngLat([-120.7275146, 47.8065614])
        .setPopup(lkwenapopup)
        .addTo(map);

     // Leavenworth Hatchery Popup
    const Lhatcherypopup = new mapboxgl.Popup({ offset: 25, scale: 3 }).setHTML(`
    <div class="popup-title">Leavenworth National Hatchery</div>
    <div class="popup-subtitle">12790 Fish Hatchery Rd, Leavenworth, WA 98826</div>
    <div class="popup-narrative">
        <strong class="golden">Contact:</strong> (509)548-7641<br><br>
        <strong class="golden">Website:</strong> <a href="https://www.fws.gov/fish-hatchery/leavenworth" target="_blank" style="color: #1E90FF;">https://www.fws.gov/</a><br><br>
        <strong class="golden">Rules:</strong> Open to the public 24/7, no vehicles allowed beyond gate. about 100yd from viewing area. <br><br>
        <strong class="golden">Bortle:</strong> 3 (Rural) <br><br>
        <strong class="golden">SQM:</strong> 21.05 <br><br>
        <strong class="golden">Viewshed:</strong><br>
        View is wide however blocked by ridge line close to horizons. Significant obstruction to the West and South. Sagiarrius can be seen in August. Light pollution from Leavenworth and Wenatchee becoming apparent, however can still see DSOs. Viewing area is pavement which creates seeing issues on hot days.  <br><br>
        <strong class="golden">Comments:</strong><br>
        Gates are closed and ehicle traffic prohibited, don't bring large telescopes here, unless for the Hatchery Star Party where gates open.
    </div>
    <div style='margin-top:1em; text-align:center;'>
      <a href="https://drive.google.com/file/d/1fEANOK_CcBfXOc-kKXfJ_vAmHJ-EvjAq/view?usp=sharing" target="_blank" style="font-size:18px; color:#1E90FF; text-decoration:underline;">View Hatchery Image</a>
    </div>
    `);
    // Make Leavenworth Hatchery popup text larger
    // Leavenworth Hatchery Marker
        const LHatchery = new mapboxgl.Marker({ color: '#fc0303', rotation: 0, scale: .5 })
            .setLngLat([ -120.67297187037192,47.558527968775024])
            .setPopup(Lhatcherypopup)
            .addTo(map);

    //  Jim Adamson Soccer Field Popup
    const jimadamsonpopup = new mapboxgl.Popup({ offset: 25, scale: 3 }).setHTML(`
    <div class="popup-title">Jim Adamson Soccerfield</div>
    <div class="popup-subtitle">19265 Beaver Valley Rd, Leavenworth, WA 98826</div>
    <div class="popup-narrative">
        <strong class="golden">Contact:</strong> (509) 763-3309<br><br>
        <strong class="golden">Website:</strong> <a href="https://www.cascadesd.org/" target="_blank" style="color: #1E90FF;">https://www.cascadesd.org/</a><br><br>
        <strong class="golden">Rules:</strong> Soccer field is on Beaver Valley Elementary School property. Soccer field open to the community use after school hours. Not allowed during school hours <br><br>
        <strong class="golden">Bortle:</strong> 3 (Rural) <br><br>
        <strong class="golden">SQM:</strong>  <br><br>
        <strong class="golden">Viewshed:</strong><br>
        View is rural sky with good eastern sky, however limited along horizon as ridge line blocks. North and North-west sky is partially blocked by trees. Neighbor lighting may be an issue at times. <br><br>
        <strong class="golden">Comments:</strong><br>
        Parking lot is at the Beaver Valley Elementary School. Soccer field is behind the old schoolhouse about 150ft east of parking area.
    </div>
    <div style='margin-top:1em; text-align:center;'>
      <a href="https://drive.google.com/file/d/15TZp-9Z-6w0N1Z5IxkoBTcuSvBLMS8Tx/view?usp=sharing" target="_blank" style="font-size:18px; color:#1E90FF; text-decoration:underline;">View Soccerfield Image</a>
    </div>
    `);
    // Make Jim Adamson popup text larger
    // Jim Adamson Marker
        const jimadamsonMarker = new mapboxgl.Marker({ color: '#fc0303', rotation: 0, scale: .5 })
            .setLngLat([ -120.66635, 47.769252])
            .setPopup(jimadamsonpopup)
            .addTo(map);

    // Chumstick Mtn Popup
    const ChumMTNpopup = new mapboxgl.Popup({ offset: 25, scale: 3 }).setHTML(`
    <div class="popup-title">Chumstick Mountain</div>
    <div class="popup-subtitle"> Lat 47.6506803, Long -120.4509177</div>
    <div class="popup-narrative">
        <strong class="golden">Contact:</strong> (509) 548-2550<br><br>
        <strong class="golden">Website:</strong> <a href="https://www.fs.usda.gov/r06/okanogan-wenatchee" target="_blank" style="color: #1E90FF;">www.fs.usda.gov/</a><br><br>
        <strong class="golden">Rules:</strong> Open to the public 24/7. Pull off and set up off roadway. do not park over vegetation, creating fire risk and wildlife disturbance.<br><br>
        <strong class="golden">Bortle:</strong> 2 (Dark Sky Site) <br><br>
        <strong class="golden">SQM:</strong> Unknown <br><br>
        <strong class="golden">Viewshed:</strong><br>
        Excellent 360 View Shed. Much of the view have below horizon views.  <br><br>
        <strong class="golden">Comments:</strong><br>
        Best route is from Eagle Creek Rd, Optional routes include Derby Canyon. Dirt road & ruts may limit accessiblity for lower clearance vehicles. Conditions at site may be dusty. Exposure on mtn may create windy conditons. A few good pull off spots near the summit to include ridgeline and summit itself. Big enough for a few vehicles and scopes.
    </div>
    <div style='margin-top:1em; text-align:center;'>
      <a href="https://drive.google.com/file/d/1tqrQT--HUzksj-nDz5yWeSOKQ0JY97Tj/view?usp=sharing" target="_blank" style="font-size:18px; color:#1E90FF; text-decoration:underline;">View Summit Image</a>
    </div> 
    <div style='margin-top:1em; text-align:center;'>
      <a href="https://drive.google.com/file/d/1evCHG0STRMlnpq4LnszJPbJEjIVcHtNP/view?usp=sharing" target="_blank" style="font-size:18px; color:#1E90FF; text-decoration:underline;">View Ridgeline Image</a>
    </div>
    `);
    // Make Chum MTN popup text larger
    // Chum MTN Marker
        const ChumMTNMarker = new mapboxgl.Marker({ color: '#fc0303', rotation: 0, scale: .5 })
            .setLngLat([ -120.4509177, 47.6506803])
            .setPopup(ChumMTNpopup)
            .addTo(map);
</script>

</body>
</html>


